---
title: "regmods-030 project"
author: "justin harding"
date: "21 July 2015"
output: pdf_document
---
```{r setup, cache = F, echo = F, message = F, warning = F, tidy = F, results='hide'}
# make this an external chunk that can be included in any file
library(knitr)
library(car)
```

```{r echo=FALSE}
fit.wt.hp.am <- lm(mpg ~ wt + hp + factor(am) + factor(am)*wt, mtcars)

summary(fit.wt.hp.am)$coef
```

## Executive Summary
From the supplied data set of a collection of cars, we are interested in exploring the relationship between a set of variables and miles per gallon (MPG) (outcome). We attempt to answer the following two questions:

* Is an automatic or manual transmission better for MPG
* Quantify the MPG difference between automatic and manual transmissions

The conclusion reached from the data given is that there is no significant statistical difference between fuel consumption of manual and automatic transmission for the average vehicle.

Further investigation shows that there is a difference in fuel consumption across the range of vehicles. For cars that weigh less/have less horspower, automatic transmission gives better fuel consumption. For cars that weigh more/have more power, manual transmission is better. So for example

weight|hp|trans|min mpg|max mpg
------|--|-----|-------|-------
2000lb|70|man|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[2] * 2 + fit.wt.hp.am$coef[3] * 70 - 2 * summary(fit.wt.hp.am)$sigma, 2)`|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[2] * 2 + fit.wt.hp.am$coef[3] * 70 + 2 * summary(fit.wt.hp.am)$sigma, 2)`
2000lb|70|auto|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4] + (fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]) * 2 + fit.wt.hp.am$coef[3] * 70 - 2 * summary(fit.wt.hp.am)$sigma, 2)`|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4] + (fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]) * 2 + fit.wt.hp.am$coef[3] * 70 + 2 * summary(fit.wt.hp.am)$sigma, 2)`
4000lb|140|man|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[2] * 4 + fit.wt.hp.am$coef[3] * 140 - 2 * summary(fit.wt.hp.am)$sigma, 2)`|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[2] * 4 + fit.wt.hp.am$coef[3] * 140 + 2 * summary(fit.wt.hp.am)$sigma, 2)`
4000lb|140|auto|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4] + (fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]) * 4 + fit.wt.hp.am$coef[3] * 140 - 2 * summary(fit.wt.hp.am)$sigma, 2)`|`r round(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4] + (fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]) * 4 + fit.wt.hp.am$coef[3] * 140 + 2 * summary(fit.wt.hp.am)$sigma, 2)`


## Procedure
Rmd file can be found at <<github>>

```{r, echo = FALSE}
fit <- lm(mpg ~ ., mtcars)
```

From the scatterplots in the appendix, it appears the predictors most correlated wth _mpg_ (miles per gallon) are _wt_ (weight), _cyl_ (no. cylinders), _disp_ (displacement), and _hp_ (horsepower). In the adjusted fits `lm(mpg ~ ., mtcars)`, only _wt_ was even slightly correlated after effects of all other fits were taken out of predictor and outcome. We will try a few models.

First `lm(mpg ~ wt, mtcars)`.

```{r, echo = FALSE}
fit.wt <- lm(mpg ~ wt, mtcars)
summary(fit.wt)$coef
```
Add _hp_ `lm(mpg ~ wt + hp, mtcars)`.

```{r, echo = FALSE}
fit.wt.hp <- update(fit, mpg ~ wt + hp)
summary(fit.wt.hp)$coef
```
And _cyl_ `lm(mpg ~ wt + hp + cyl, mtcars)`.
```{r, echo = FALSE}
fit.wt.hp.cyl <- update(fit, mpg ~ wt + hp + cyl)
summary(fit.wt.hp.cyl)$coef
```

Or perhaps _disp_ `lm(mpg ~ wt + hp + disp, mtcars)`.
```{r, echo = FALSE}
fit.wt.hp.disp <- update(fit, mpg ~ wt + hp + disp)
summary(fit.wt.hp.disp)$coef
```

Both _cyl_ and _disp_ do not add anything useful to the model. An excerpt from the correlation matrix shows us that they are both quite highly correlated with existing terms.
```{r, echo = FALSE}
cor(mtcars)[c(4,6),c(1:6)]
```
Comparing the models with `anova` shows us also that the extras terms do not help.

```{r, echo = FALSE}
anova(fit.wt, fit.wt.hp, fit.wt.hp.cyl)
anova(fit.wt, fit.wt.hp, fit.wt.hp.disp)
```

vif confirms this
```{r}
sqrt(vif(fit.wt.hp.cyl))
sqrt(vif(fit.wt.hp.disp))
sqrt(vif(fit.wt.hp))
```

So we will use `fit.wt.hp <- lm(mpg ~ wt + hp, mtcars)` as our model

The residuals density plot and quantile plot both show that there are issues with the data. Fiat 128, Toyota Corolla and Chrysler Imperial are all quite a way off the normal. This can also be seen from `dfbetas(fit.wt.hp)`. The `hatvalues(fit.wt.hp)` plot shows us that the Maserati Bora is well off the normal.
```{r}
plot(density(resid(fit.wt.hp)))
plot(fit.wt.hp, which = 2)
round(dfbetas(fit.wt.hp)[15:23,], 3)
round(hatvalues(fit.wt.hp), 3)
plot(hatvalues(fit.wt.hp))
```

Now consider the effect of transmission type.
```{r}
fit.wt.hp.am.same.slope <- lm(mpg ~ wt + hp + factor(am), mtcars)
summary(fit.wt.hp.am.same.slope)
```

From the model `lm(mpg ~ wt + hp + factor(am))` looking at the line for factor(am)1, we have confidence interval of `r round(confint(fit.wt.hp.am.same.slope)[4,1], 3)` to  `r round(confint(fit.wt.hp.am.same.slope)[4,2], 3)` and we have a p value greater than 0.05 which means we cannot rule out the NULL hypothesis. This in turn means we cannot rule out the possibility that transmission type has no effect on fuel consumption.

```{r}
fit.wt.hp.am <- lm(mpg ~ wt + hp + factor(am) + factor(am)*wt, mtcars)
summary(fit.wt.hp.am)
plot(mtcars$wt, mtcars$mpg, pch = 19)
points(mtcars$wt, mtcars$mpg, pch = 19, col = ((mtcars$am==1) * 1 + 1))
abline(c(fit.wt.hp.am$coef[1], fit.wt.hp.am$coef[2]), col="black", lwd=3)
abline(c(fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4], fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]), col="red", lwd=3)
```

If we allow our models to have different slopes, it does looks like manual cars and automatic cars do have different characteristics though. Manual cars have fuel consumption of `r fit.wt.hp.am$coef[1]` `+` `r fit.wt.hp.am$coef[2]` `* wt +` `r fit.wt.hp.am$coef[3]` `* hp` and automatic cars have fuel consumption of `r fit.wt.hp.am$coef[1] + fit.wt.hp.am$coef[4]` `+ (` `r fit.wt.hp.am$coef[2] + fit.wt.hp.am$coef[5]` `) * wt + ` `r fit.wt.hp.am$coef[3]` ` * hp`

*** Appendix
Note: Assuming tables can be considered figures for inclusion in Appendix.

[pairs]:
```{r}
pairs(mtcars)
kable(summary(fit)$coef, booktabs = TRUE)

```
Correlation Matrix
```{r}
cor(mtcars)
```
